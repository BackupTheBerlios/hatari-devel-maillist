<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [hatari-devel] Suggestion about small additions for v1.4
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/hatari-devel/2010q2/index.html" >
   <LINK REL="made" HREF="mailto:hatari-devel%40lists.berlios.de?Subject=Re%3A%20%5Bhatari-devel%5D%20Suggestion%20about%20small%20additions%20for%20v1.4&In-Reply-To=%3C201005122225.57518.eerot%40users.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002061.html">
   <LINK REL="Next"  HREF="002067.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[hatari-devel] Suggestion about small additions for v1.4</H1>
    <B>Eero Tamminen</B> 
    <A HREF="mailto:hatari-devel%40lists.berlios.de?Subject=Re%3A%20%5Bhatari-devel%5D%20Suggestion%20about%20small%20additions%20for%20v1.4&In-Reply-To=%3C201005122225.57518.eerot%40users.berlios.de%3E"
       TITLE="[hatari-devel] Suggestion about small additions for v1.4">eerot at users.berlios.de
       </A><BR>
    <I>Wed May 12 21:25:57 CEST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="002061.html">[hatari-devel] Suggestion about small additions for v1.4
</A></li>
        <LI>Next message: <A HREF="002067.html">[hatari-devel] Suggestion about small additions for v1.4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2066">[ date ]</a>
              <a href="thread.html#2066">[ thread ]</a>
              <a href="subject.html#2066">[ subject ]</a>
              <a href="author.html#2066">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

On Wednesday 12 May 2010, Anders Eriksson wrote:
&gt;<i> On Tue, 11 May 2010, Eero Tamminen wrote:
</I>&gt;<i> &gt; Things that it does are just:
</I>&gt;<i> &gt; 1. save (just) the area below the square
</I>&gt;<i> &gt; &lt;screen update&gt;
</I>&gt;<i> &gt; 2. blit the square, but only when needed
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This doesn't have noticeable impact on Hatari speed on Linux, but maybe
</I>&gt;<i> &gt; OSX/SDL want e.g. to do VSync() both on reading a minuscule piece of
</I>&gt;<i> &gt; the window contents and writing a similar minuscule piece back to it...
</I>&gt;<i>
</I>&gt;<i> this only happens in windowed mode. In Fullscreen it seems to work
</I>&gt;<i> better.
</I>&gt;<i>
</I>&gt;<i> Just like Hatari in general, the windowed mode on OS X is really, 
</I>&gt;<i> really, really slow. But we've been over this a thousand times already.
</I>
Claiming that things are &quot;slow&quot; isn't same as clearly stating that it
doesn't work (even nearly) as fast as it should.


Only thing that has been reported earlier to us was an issue by K&#229;re which
turned to be a bug which sometimes caused an unrelated variable to be
overwritten.  In OSX build, that variable was frameskip (on Linux it was
something that wasn't visible to users)...  If I remember correctly, it was 
fixed last year, already for v1.3.


Does the slowness you're reporting happen only when overlay LED is
enabled (not necessary visible) and statusbar is disabled?

Or does it happen also if statusbar is enabled or both statusbar &amp; led are
disabled?


&gt;<i> Here's a little video showing the HUD in action:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://ae.dhs.nu/tmp/hatari_hud.mp4">http://ae.dhs.nu/tmp/hatari_hud.mp4</A>
</I>
To me it seems 1/2 (or maybe 1/3) of normal speed.  I think easy way to
check how much the slowdown is would be to try frameskip values of 1 or 2.


Btw. If OSX SDL is doing VSync() on windowed mode and you have an LCD
monitor, you probably should be running Hatari with frameskip anyway.
Otherwise OSX/SDL is forcing e.g. monochrome mode (71Hz updates...) to
be running too slowly as LCD refresh is usually something like 60Hz.

(My CRT refresh is 85Hz so I cannot see issues like this.)


&gt;<i> &gt; Because Falcon &amp; TT screen updates work differently (everything is
</I>&gt;<i> &gt; updated everytime), step 1) is skipped there.  Do you see less slowdown
</I>&gt;<i> &gt; there?
</I>&gt;<i>
</I>&gt;<i> I don't know how to test this, do you have an idea of a Falcon program
</I>&gt;<i> using the floppy while for example playing music?
</I>
Harddisk is a disk too. :-)

Just use &quot;hatari -d .&quot;


&gt;<i> &gt; Use &quot;--statusbar off&quot;[1], or set bShowDriveLed in configuration file to
</I>&gt;<i> &gt; FALSE.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I had it for a while in the Hatari SDL GUI too, but had to remove it to
</I>&gt;<i> &gt; make space for other options.  Attached is a patch to have it back, but
</I>&gt;<i> &gt; it makes the screen dialog look a bit off-balance and it would need the
</I>&gt;<i> &gt; HTML manual update too.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The Python/Gtk Hatari GUI of course has an option for this in its UI.
</I>&gt;<i>
</I>&gt;<i> But nobody seems to use this GTK thing
</I>
On Windows &amp; OSX getting Python &amp; Gtk is a bit hard, so I don't expect users
from them normally to have them installed.

They're preinstalled on normal Linux distros (which is the main target
for Hatari).


&gt;<i> and on Windows there's only the 
</I>&gt;<i> SDL one and the OS X GUI seems to lag behind all the time, and as Jerome
</I>&gt;<i> said, his OS X updates does not seem to get submitted.
</I>
If Jerome thinks they're ready for inclusion review, he should send them for
review.


&gt;<i> Anyway thanks for the patch, any chance this could come to the repo as
</I>&gt;<i> well? When I do patches myself I always end up in conflicts with the repo
</I>&gt;<i> :)
</I>
Laurent &amp; Nicolas said that this kind of stuff should go in after v1.4, so
it will wait until release.


&gt;<i> &gt; If you have specific configuration between which you'd like to use,
</I>&gt;<i> &gt; IMHO easiest way is to add shortcuts to your desktop which tell Hatari
</I>&gt;<i> &gt; which config file to use (with &quot;--configfile &lt;file&gt;&quot; option).
</I>&gt;<i>
</I>&gt;<i> That would open a terminal window as it involves doing a script, which is
</I>&gt;<i> why I use the custom made application instead.
</I>
Is OSX that primitive? :-)

I can do that without a script on Linux and I think it's possible on Windows
also.  Heck, it's even possible to do in Atari Teradesk (not as desktop
icon, but for programs configured to handle specific file types).


&gt;<i> To have this in the drop down menu bar would be ideal.
</I>&gt;<i>
</I>&gt;<i> &gt; Attached is mostly untested patch for adding question on whether the
</I>&gt;<i> &gt; (last) succesfully created disk image should be inserted to drive A:. I
</I>&gt;<i> &gt; think drive B: is too rare case to worry about (and it would need
</I>&gt;<i> &gt; creating a new dialog).
</I>&gt;<i>
</I>&gt;<i> Thanks for this patch, I hope it goes into the repo as well :) However
</I>&gt;<i> having an alert with three options should be doable?
</I>&gt;<i>
</I>&gt;<i> Mount A:  | Mount B:  |&#160;Don't mount
</I>
It's of course doable, but would need more code and is something that
can be done later.


&gt;<i> &gt;&gt; 4. Then we have the usual long-term request of using the current
</I>&gt;<i> &gt;&gt; resolution and refreshrate instead of changing it when going to
</I>&gt;<i> &gt;&gt; fullscreen.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Resolution thing should already work for Falcon &amp; TT screens?
</I>&gt;<i> &gt; They use completely different code from ST/STE.
</I>&gt;<i>
</I>&gt;<i> I don't see how TT/Falcon mode would not alter refresh rate in
</I>&gt;<i> fullscreen? The resolution definitly changes to something else than my
</I>&gt;<i> native res.
</I>&gt;<i>
</I>&gt;<i> &gt; Hatari doesn't have any control over refresh rate or how fullscreening
</I>&gt;<i> &gt; is implemented, only what what window/screen size it would like to
</I>&gt;<i> &gt; have. Rest is (intentionally) hidden by SDL.
</I>&gt;<i>
</I>&gt;<i> Yes, that's why the technicque of changing resolution is flawed to begin
</I>&gt;<i> with. Fullscreen should use the _current_ resolution without any change
</I>&gt;<i> and scale the graphics accordingly.
</I>
Hm.  After some googling, an API seems to have been added to SDL
in v1.2.10 to get the current resolution:
	<A HREF="http://www.libsdl.org/cgi/docwiki.cgi/SDL_VideoInfo">http://www.libsdl.org/cgi/docwiki.cgi/SDL_VideoInfo</A>

I assume it would need to be called before setting the Hatari window size
for the first time.


Does anybody know whether there are still used/updated Linux distributions
or OSX / Windows / BSD versions which ship with an older version of SDL?


&gt;<i> All comptuers made the last decade or 
</I>&gt;<i> so have hardware scaling support, and older machines than that are too
</I>&gt;<i> slow for Hatari anyways. Apart from the hwardware scaling, a modern
</I>&gt;<i> compter can do software scaling without a blink as well.
</I>
Well, yours seems to have problems getting the updates to screen
frequently enough.  ;-))


&gt;<i> See the Vice emulator as a great example how things can be implemented.
</I>
Is it implemented on top of SDL?


&gt;<i> &gt; You could try whether removing HWSURFACE option from screen.c has
</I>&gt;<i> &gt; any effect on this.  If it has, we could consider making it optional.
</I>&gt;<i>
</I>&gt;<i> This wouldn't even let me go to fullscreen at all.
</I>
It works fine on Linux SDL.  Please file a bug against OSX SDL,
HWSURFACE is an optional thing according to SDL documenation.

See the documentation on it to see why I asked to test removing it:
	<A HREF="http://www.libsdl.org/cgi/docwiki.cgi/SDL_SetVideoMode">http://www.libsdl.org/cgi/docwiki.cgi/SDL_SetVideoMode</A>


	- Eero

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002061.html">[hatari-devel] Suggestion about small additions for v1.4
</A></li>
	<LI>Next message: <A HREF="002067.html">[hatari-devel] Suggestion about small additions for v1.4
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2066">[ date ]</a>
              <a href="thread.html#2066">[ thread ]</a>
              <a href="subject.html#2066">[ subject ]</a>
              <a href="author.html#2066">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/hatari-devel">More information about the hatari-devel
mailing list</a><br>
</body></html>
